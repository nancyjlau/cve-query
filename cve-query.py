import requests, json

def FindInYear(keyword, year):
    url = f'https://api.cvesearch.com/search?q={keyword}&year={year}'
    response = requests.request("GET", url, headers={}, data={})

    return json.loads(response.text).get("meta")["count"]

def DumpEntryYears(keyword):
    url = f'https://api.cvesearch.com/search?q={keyword}'
    response = requests.request("GET", url, headers={}, data={})
    dat = json.loads(response.text).get("response")
    
    # From results, loop through each CVE and dump the year to a CSV file
    for cve in dat:
        print(f'{cve} in year {dat[cve]["basic"]["year"]}')
        
        # Write to CSV file
        logged = []
        with open(f'csv_results/{keyword}_over_time.csv', 'a') as f:
            if cve not in logged:
                f.write(f'{cve},{dat[cve]["basic"]["year"]}\n')
                logged.append(cve)
    
# graph by year/vendor/product

DumpEntryYears("uefi")
DumpEntryYears("smm")
DumpEntryYears("SWSMI")
DumpEntryYears("SMRAM")
DumpEntryYears("DXE")
DumpEntryYears("SMM memory corruption")
